# =============================================================================
# Image Processing Configuration
# =============================================================================
# Controls image preprocessing before LLM API calls and text post-processing.
# Loaded by: modules/image_utils.py, modules/text_cleaner.py
#
# Related config files:
#   - app.yaml: Application settings and feature toggles
#   - model.yaml: LLM provider and model settings
#   - concurrency.yaml: API rate limits and parallelism

# =============================================================================
# API Image Processing
# =============================================================================
# Preprocessing applied to images before sending to LLM APIs (OpenAI, etc.)
# Optimizes for OCR quality while managing token usage
api_image_processing:
  # PDF rendering resolution (higher = better quality, more tokens)
  target_dpi: 300  # 150-300 recommended for OCR
  
  # Preprocessing steps
  grayscale_conversion: true  # Convert to grayscale (improves OCR, reduces noise)
  handle_transparency: true   # Flatten alpha channel onto white background
  
  # Image fidelity for OpenAI Vision API
  # high = better OCR, more tokens | low = faster, cheaper | auto = model decides
  llm_detail: high
  
  # JPEG compression quality (1-100). Higher = better quality, larger files
  jpeg_quality: 100
  
  # Resize strategy: 'high' | 'low' | 'auto' | 'none'
  # high = fit to high_target_box | low = cap at low_max_side_px | none = no resize
  resize_profile: high
  
  # Resize parameters
  low_max_side_px: 512         # Max dimension for 'low' profile
  high_target_box: [768, 1536] # [width, height] target for 'high' profile


# =============================================================================
# Text Cleaning Configuration
# =============================================================================
# Post-processing for transcription text before summarization and output.
# Fixes common OCR artifacts while preserving semantic content.

text_cleaning:
  enabled: true  # Master switch for all text cleaning
  
  # ---------------------------------------------------------------------------
  # Unicode Normalization
  # ---------------------------------------------------------------------------
  # NFC normalization, removes control chars, soft hyphens, zero-width spaces
  unicode_normalization: true
  
  # ---------------------------------------------------------------------------
  # LaTeX Formula Fixing
  # ---------------------------------------------------------------------------
  # Repairs common OCR errors in mathematical notation
  latex_fixing:
    enabled: true
    balance_dollar_signs: true   # Fix unbalanced $ and $$ delimiters
    close_unclosed_braces: true  # Close orphan { in LaTeX commands
    fix_common_commands: true    # Fix typos like "\frac {" -> "\frac{"
  
  # ---------------------------------------------------------------------------
  # Hyphenation Merging
  # ---------------------------------------------------------------------------
  # Rejoins words split at line breaks: "politi-\nche" -> "politiche"
  # WARNING: Can damage genuine compounds like "Jean-Baptiste"
  merge_hyphenation: false  # Disabled by default - enable for scanned books
  
  # ---------------------------------------------------------------------------
  # Whitespace Normalization
  # ---------------------------------------------------------------------------
  whitespace_normalization:
    enabled: true
    collapse_internal_spaces: true  # 3+ spaces -> 2 spaces
    max_blank_lines: 2              # Remove excess blank lines
    tab_size: 4                     # Spaces per tab when expanding
  
  # ---------------------------------------------------------------------------
  # Line Wrapping
  # ---------------------------------------------------------------------------
  # Wrap excessively long lines (usually not needed for LLM output)
  line_wrapping:
    enabled: true
    auto_width: true   # Compute width from text statistics
    fixed_width: 80    # Used if auto_width is false
